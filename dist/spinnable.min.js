"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),Spinnable=function(){function t(e,i){_classCallCheck(this,t),this.guid=this.createGUID(),this.el=e,this.data=i.data,this.size=i.size||200,this.colors=i.colors||["#FF6138","#FFFF9D","#BEEB9F","#79BD8F","#00A388"],this.delay=i.delay||2,this.numOfSpins=i.numOfSpins||2,this.repeat=i.repeat||!0,this.rotation=-90,this.value=null,this.spinning=!1,this.repeating=i.repeating,this.alreadySelected=[],this.availableData=[],this.stroke=i.stroke,this.borderSize=i.borderSize||0,this.borderColor=i.borderColor||"transparent",this.centerCircleSize=i.centerCircleSize||20,this.centerCircleColor=i.centerCircleColor||"#fff",this.arrowColor=i.arrowColor||"#fff",this.afterSelected=i.afterSelected||function(){},this.afterAllSelected=i.afterAllSelected||function(){},this.trueSize=this.size+this.borderSize,this.init()}return _createClass(t,[{key:"init",value:function(){this.renderSpinner(),this.setElements(),this.parseData(),this.filterAvailableData(),this.renderSections(),this.setEventListeners(),this.setTransition()}},{key:"createGUID",value:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()}},{key:"renderSpinner",value:function(){this.el.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" data-guid="'+this.guid+'" style="display: block; margin: 0 auto;" version="1.1" width="'+this.trueSize+'" height="'+this.trueSize+'" viewBox="0 0 '+this.trueSize+" "+this.trueSize+'" preserveAspectRatio>\n                <circle cx="'+this.trueSize/2+'" cy="'+this.trueSize/2+'" r="'+this.trueSize/2+'" fill="'+this.borderColor+'"/>\n                <g transform="translate('+this.trueSize/2+", "+this.trueSize/2+')">\n                    <g class="spinner-group" style="transform: rotate('+this.rotation+'deg)">\n\n                    </g>\n                </g>\n                <g id="spinner-board"></g>\n                <path id="spinner-arrow" d="M '+(this.trueSize/2-5)+" "+this.trueSize/2+" L "+(this.trueSize/2-5)+" "+this.trueSize/4+" L "+(this.trueSize/2-12)+" "+this.trueSize/4+" L "+this.trueSize/2+" "+(this.trueSize/4-20)+" L "+(this.trueSize/2+12)+" "+this.trueSize/4+" L "+(this.trueSize/2+5)+" "+this.trueSize/4+" "+(this.trueSize/2+5)+" "+this.trueSize/2+' Z" fill="'+this.arrowColor+'" stroke="#222222" style="stroke-width:2px"/>\n                <circle id="spinner-center" cx="'+this.trueSize/2+'" cy="'+this.trueSize/2+'" r="'+this.centerCircleSize+'" fill="'+this.centerCircleColor+'" stroke="#222222" style="stroke-width:2px"/>\n            </svg>'}},{key:"setElements",value:function(){this.spinnerGroup=document.querySelector("[data-guid='"+this.guid+"'] .spinner-group"),this.spinnerArrow=document.querySelector("[data-guid='"+this.guid+"'] #spinner-arrow"),this.spinnerCenter=document.querySelector("[data-guid='"+this.guid+"'] #spinner-center")}},{key:"renderSections",value:function(){for(var t="http://www.w3.org/2000/svg",e=this.data,i=e[0].endAngle-e[0].startAngle,r=0;r<e.length;r++)this.spinnerGroup.innerHTML=this.spinnerGroup.innerHTML+('<g transform="rotate('+i*r+')">\n                    <path d="'+e[r].d+'" fill="'+e[r].color+'" stroke="#fff" stroke-width="'+(this.stroke||0)+'"/>\n                </g>');if(this.text)for(var n=0;n<this.spinnerGroup.children.length;n++){var s=this.spinnerGroup.children[n],a=document.createElementNS(t,"text");a.setAttribute("x",this.trueSize/4),a.setAttribute("y",this.trueSize/4),a.innerHTML=this.data[n].datum,console.log(a),s.appendChild(a),console.log(s)}}},{key:"parseData",value:function(){var t=this,e=0,i=0,r=1/this.data.length;this.data=this.data.map(function(n,s){i=e,e=i+360*r;var a=void 0,o=void 0,l=void 0,h=void 0;a=parseInt(Math.round(t.size/2*Math.cos(0*Math.PI/180))),l=parseInt(Math.round(t.size/2*Math.sin(0*Math.PI/180))),o=parseInt(Math.round(t.size/2*Math.cos(Math.PI*(360*r)/180))),h=parseInt(Math.round(t.size/2*Math.sin(Math.PI*(360*r)/180)));var u="M0,0  L"+a+","+l+("  A"+t.size/2+","+t.size/2+" 0 ")+(360*r-0>180?1:0)+",1 "+o+","+h+" z";return{datum:n,startAngle:i,endAngle:e,d:u,color:t.colors[s]}}),console.log(this.data)}},{key:"rotateSpinner",value:function(){var t=this;this.spinning||!function(){t.spinning=!0;var e=t.availableData[Math.floor(Math.random()*t.availableData.length)];t.repeating||t.updateSelected(e);var i=t.rotation%360,r=Math.random()+1;t.rotation=t.rotation+(360*t.numOfSpins+(360-e.endAngle+Math.floor(Math.random()*((e.endAngle-e.startAngle)/2)*r))-90-i),t.spinnerGroup.style.transform="rotate("+t.rotation+"deg)",setTimeout(function(){t.afterSelected(e),t.repeating||0!==t.availableData.length||t.afterAllSelected(e)},1e3*t.delay),setTimeout(function(){t.spinning=!1},1e3*t.delay)}()}},{key:"updateSelected",value:function(t){this.alreadySelected.push(t),this.filterAvailableData()}},{key:"filterAvailableData",value:function(){var t=this;this.availableData=this.data.filter(function(e){return t.alreadySelected.indexOf(e)===-1})}},{key:"setEventListeners",value:function(){this.spinnerGroup.addEventListener("click",this.rotateSpinner.bind(this)),this.spinnerArrow.addEventListener("click",this.rotateSpinner.bind(this)),this.spinnerCenter.addEventListener("click",this.rotateSpinner.bind(this))}},{key:"setTransition",value:function(){var t=this.spinnerGroup;t.style.WebkitTransition=this.delay+"s",t.style.mozTransition=this.delay+"s",t.style.msTransition=this.delay+"s",t.style.oTransition=this.delay+"s"}}]),t}();